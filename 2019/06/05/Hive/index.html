<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="ok"><title>Hive | K</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Hive</h1><a id="logo" href="/.">K</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Hive</h1><div class="post-meta">Jun 5, 2019</div><div class="post-content"><h3 id="Hive"><a href="#Hive" class="headerlink" title="Hive"></a>Hive</h3><h4 id="1-什么是hive"><a href="#1-什么是hive" class="headerlink" title="1.什么是hive"></a>1.什么是hive</h4><ul>
<li>Hive是sql语句的翻译器,将sql语句翻译成MapReduce的程序,hive使用另外有一个数据库进行存储,实际工作中的用的MySQL,其他数据库也可以,</li>
<li><p>在hive中嵌入了一个derty,如果只是做练习可以不装MySQL.derty是用来装hive建的表的元数据</p>
</li>
<li><p>是基于Hadoop的一个数据仓库工具</p>
</li>
<li><p>可以将结构化的数据映射为一张数据库表</p>
</li>
</ul>
<ul>
<li><p>底层数据是存储在 HDFS 上</p>
</li>
<li><p>Hive的本质是将 SQL 语句转换为 MapReduce 任务运行</p>
</li>
<li><p>使不熟悉 MapReduce 的用户很方便地利用 HQL 处理和计算 HDFS 上的结构化的数据，适用于离线的批量数据计算。</p>
<h4 id="2-hive安装"><a href="#2-hive安装" class="headerlink" title="2.hive安装"></a>2.hive安装</h4></li>
</ul>
<p>进入<a href="https://hive.apache.org" target="_blank" rel="noopener">hive官网</a>点击<strong>Downloads</strong><br>下载发行版,点击<strong>Download a release now</strong>选择版本进行下载</p>
<h4 id="3-解压下载的hive压缩包"><a href="#3-解压下载的hive压缩包" class="headerlink" title="3.解压下载的hive压缩包"></a>3.解压下载的hive压缩包</h4><p>使用命令 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf apache-hive-<span class="number">2.3</span>.3-bin.tar.gz <span class="comment">//解压到当前目录下</span></span><br><span class="line"><span class="comment">/* 将解压后的文件移动到 /usr/local下 */</span></span><br><span class="line">mv apache-hive-<span class="number">2.3</span>.3-bin /usr/local</span><br><span class="line"><span class="comment">/*若嫌解压后的文件名过长 可使用mv命令进行重命名 例:命名为hive*/</span></span><br><span class="line">mv apache-hive-<span class="number">2.3</span>.3-bin hive</span><br></pre></td></tr></table></figure>
<h4 id="4-配置环境"><a href="#4-配置环境" class="headerlink" title="4.配置环境"></a>4.配置环境</h4><p>打开系统的配置文件<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vim etc/profile</span><br><span class="line"><span class="comment">/*在页尾添加*/</span></span><br><span class="line">export HADOOP_HOME=/usr/local/hadoop</span><br><span class="line">export HIVE_HOME=/usr/local/hive</span><br><span class="line">export PATH=SPATH:/usr/local/hadoop/bin:/usr/local/hadoop/sbin</span><br><span class="line">export PATH=$PATH:HIVE_HOME/bin</span><br><span class="line"><span class="comment">/*shift+: 输入!q 保存并退出*/</span></span><br></pre></td></tr></table></figure></p>
<p>输入命令<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /etc/profile <span class="comment">//使配置文件生效</span></span><br></pre></td></tr></table></figure></p>
<p>在终端下输入hive命令  如果可以执行 则path环境变量配置成功  PS:目前还没有配置完 会出现错误</p>
<h4 id="5-修改hive配置文件"><a href="#5-修改hive配置文件" class="headerlink" title="5.修改hive配置文件"></a>5.修改hive配置文件</h4><p>进入hive目录<br>创建一个tmp目录   一会修改配置文件会用到<br>mkdir tmp<br>之后cd到conf目录下<br>打开 <strong>hive-site.xml</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*如果没有这个文件,使用cp命令拷贝一份默认的配置文件进行修改*/</span></span><br><span class="line">cp hive-<span class="keyword">default</span>.xml.template hive-site.xml</span><br><span class="line"><span class="comment">/*打开hive-site.xml*/</span></span><br><span class="line">vim hive-site.xml</span><br></pre></td></tr></table></figure></p>
<p>找到 <strong>hive.metastore.schema.verification</strong>默认为true,将其设定位false</p>
<blockquote>
<p>复制之前创建的tmp路径,替换掉<strong>${system:java.io.tmpdir}</strong> PS:有多个地方要将其全部替换掉</p>
<blockquote>
<p>替换 <strong>${system:user.name}为root</strong> 同上</p>
</blockquote>
</blockquote>
<p>执行命令<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">schematool -initSchema -dbType derty<span class="comment">//用来初始化derty   PS:若用的MySQL将derty修改成MySQL即可</span></span><br></pre></td></tr></table></figure></p>
<p>等待命令执行完毕,当看到schemaTool completed则执行完毕,执行成功后在当前目录下可以看到一个<strong>metastore_db</strong>这里面存储着hive的元数据.<br>如果出错,则删除metastore_db在重新执行一遍命令<br><strong>如果用的是hive的内嵌数据库,运行hive要在同一目录下.</strong></p>
<h4 id="6-启动hive"><a href="#6-启动hive" class="headerlink" title="6.启动hive"></a>6.启动hive</h4><h4 id="基本命令与MySQL相似"><a href="#基本命令与MySQL相似" class="headerlink" title="基本命令与MySQL相似"></a>基本命令与MySQL相似</h4><p>使用默认的数据库创建一个表 wordcount</p>
<h4 id="7-hive装载数据"><a href="#7-hive装载数据" class="headerlink" title="7.hive装载数据"></a>7.hive装载数据</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">load data inpath <span class="string">'/wcinput/ overwrite into table wordcount'</span></span><br><span class="line"><span class="comment">/*这句命令的意思是:加载wcinput数据装载到wordcount这张表里*/</span></span><br><span class="line"><span class="comment">/*注意的是:真正的数据并没有移动,只是通过wordcount这张表可以访问,hive相当于是一个纽带或者是通道*/</span></span><br></pre></td></tr></table></figure>
<p>将数据导入 ,将一个文本内容数据导入<br>例:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*将input.txt导入到wcinput中*/</span></span><br><span class="line">cd <span class="comment">//进入跟目录</span></span><br><span class="line">hadoop fs -put input.txt /wcinput/</span><br><span class="line">cd /usr/local/hive <span class="comment">//进入hive目录中</span></span><br><span class="line">hive <span class="comment">//执行hive 进入到hive中去</span></span><br><span class="line">load data inpath <span class="string">'/wcinput/ overwrite into table wordcount'</span> <span class="comment">//执行装载命令</span></span><br></pre></td></tr></table></figure></p>
<h4 id="8-使用hive操作数据"><a href="#8-使用hive操作数据" class="headerlink" title="8.使用hive操作数据"></a>8.使用hive操作数据</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*查询数据*/</span></span><br><span class="line">select * from wordcount;</span><br><span class="line"><span class="comment">/*split函数:将某一个字段按照什么规则切分*/</span></span><br><span class="line">例:</span><br><span class="line"><span class="function">select <span class="title">split</span><span class="params">(line,<span class="string">' '</span>)</span> from wordcount</span>; <span class="comment">//按空格进行切分,切分成一个个的数组</span></span><br><span class="line"><span class="comment">/*explode函数:把每一个数组里的单词拿出来,作为一行单独输出*/</span></span><br><span class="line"><span class="function">select <span class="title">explode</span><span class="params">(split(line,<span class="string">' '</span>)</span>) from wordcount</span>;</span><br><span class="line"><span class="comment">/*将查询结果单独生成一张表,并起别名*/</span></span><br><span class="line">(<span class="function">select <span class="title">explode</span><span class="params">(split(line,<span class="string">' '</span>)</span>) as word from wordcount) w</span>;<span class="comment">//有一个字段叫word,别名为W</span></span><br><span class="line"><span class="comment">/*计算每个单词出现的次数*/</span></span><br><span class="line">select word,count(<span class="number">1</span>) <span class="function">as count <span class="title">from</span> <span class="params">(select explode(split(line,<span class="string">' '</span>)</span>) as word from wordcount) w group by word</span>;<span class="comment">//开始执行map和reduce程序</span></span><br></pre></td></tr></table></figure>
<h4 id="9-案例"><a href="#9-案例" class="headerlink" title="9.案例"></a>9.案例</h4><p>例如一个日志文件<br><img src="/home/lks/Bk/blog/public/img/hive/1.jpg" alt><br>将其进行处理后,<strong>可使用pig进行数据清洗,转换格式</strong><br><img src="/home/lks/Bk/blog/public/img/hive/2.png" alt><br>只保留了时间 id 标题和url 用逗号隔开<br>将处理后的文件上传</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -put sougou.dic / <span class="comment">//上传到根目录下</span></span><br><span class="line"><span class="comment">/*创建一个与其对应的表*/</span></span><br><span class="line"><span class="function">create table <span class="title">sgr</span><span class="params">(qtime string,qid string,qword string,url string)</span> row format delimited fields terminated by ','</span>;<span class="comment">//使用逗号来分割字符,与文件中对应</span></span><br><span class="line"><span class="comment">/*装载数据*/</span></span><br><span class="line">load data inpath <span class="string">'/sougou.dic'</span> into table sgr;<span class="comment">//建立映射,可通过表来访问数据</span></span><br><span class="line"><span class="comment">/*执行查询*/</span></span><br><span class="line"><span class="function">seletc <span class="title">count</span><span class="params">(*)</span> from sgr</span>;</span><br></pre></td></tr></table></figure>
<h4 id="10-找出热搜榜"><a href="#10-找出热搜榜" class="headerlink" title="10.找出热搜榜"></a>10.找出热搜榜</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*创建一个sougoud的执行结果表*/</span></span><br><span class="line">create table sgr_results as select keyword, count(<span class="number">1</span>) <span class="function">as count <span class="title">from</span> <span class="params">(select qword as keyword from sgr)</span> t group by keyword order by count desc</span>;<span class="comment">//等待执行完毕</span></span><br><span class="line"><span class="comment">/*进行查询*/</span></span><br><span class="line">select * from sgr_results limit <span class="number">10</span>;<span class="comment">//取前10条</span></span><br></pre></td></tr></table></figure>
<p><img src="/home/lks/Bk/blog/public/img/hive/3.jpg" alt> </p>
</div><div class="tags"></div><div class="post-nav"><a class="pre" href="/2019/06/11/Java高并发AQS/"></a><a class="next" href="/2019/05/15/Radius/">Radius</a></div><div id="lv-container" data-id="city" data-uid="MTAyMC80NDIzMC8yMDc2Mw=="><script>(function(d, s) {
   var j, e = d.getElementsByTagName(s)[0];
   if (typeof LivereTower === 'function') { return; }
   j = d.createElement(s);
   j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
   j.async = true;
   e.parentNode.insertBefore(j, e);
})(document, 'script');
</script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="https://ly700.github.io"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/基础技能/" style="font-size: 15px;">基础技能</a> <a href="/tags/博客搭建/" style="font-size: 15px;">博客搭建</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/06/11/Java高并发AQS/">Java高并发AQS</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/06/05/Hive/">Hive</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/15/Radius/">Radius</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/13/搭建博客/">在Linux下搭建博客</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.baidu.com" title="百度" target="_blank">百度</a><ul></ul><a href="http://www.google.com/" title="google" target="_blank">google</a><ul></ul><a target="_blank"></a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">K.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>